<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
    <title>ë³‘ì› ì˜ˆì•½</title>
    <link rel="stylesheet" href="/webjars/bootstrap/4.5.0/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">

      <!--  ì¹´ì¹´ì˜¤ ì§€ë„ API ë¡œë“œ  -->
    <script type="text/javascript" 
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2e9e13d9828d100f6d488ab7d8cf5a82&libraries=services" >
    </script>
	<style>
		body {
					    font-family: 'Pretendard', sans-serif;
					}
/* âœ… í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
table {
    width: 100%;
    border-collapse: collapse;
    border-spacing: 0; /* âœ… ì…€ ê°„ê²© ì œê±° */
}

/* âœ… í…Œì´ë¸” í—¤ë” ìŠ¤íƒ€ì¼ */
thead th {
    position: sticky;
    top: 0;
    background-color: #fff3cd; /* ì—°í•œ ë…¸ë€ìƒ‰ */
    font-weight: bold;
    font-size: 16px;
    text-align: center;
    padding: 12px;
    min-width: 80px;
    z-index: 1000;
    border-bottom: 2px solid #ddd; /* âœ… í—¤ë”ì™€ ë³¸ë¬¸ ì‚¬ì´ì˜ êµ¬ë¶„ì„  */
    margin-bottom: 0; /* âœ… í—¤ë” ì•„ë˜ ë¶ˆí•„ìš”í•œ ì—¬ë°± ì œê±° */
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1); /* âœ… í—¤ë” ì•„ë˜ ê·¸ë¦¼ì ì¶”ê°€ */
}

/* âœ… í…Œì´ë¸” ë³¸ë¬¸ ì…€ ìŠ¤íƒ€ì¼ */
td {
    text-align: center;
    padding: 12px;
    border: 1px solid #ddd;
    font-size: 15px;
}

/* âœ… í…Œì´ë¸” ì»¨í…Œì´ë„ˆ (ìŠ¤í¬ë¡¤ ì¡°ì •) */
.table-container {
    max-height: 700px; /* í…Œì´ë¸” ë†’ì´ ì¦ê°€ */
    overflow-y: auto;
    border: 1px solid #ccc;
}

        #mapModal {
			display: none;
			position: fixed;
   			top: 50px;
			left: 50%;
    		transform: translateX(-50%);
    		z-index: 1000; /* ëª¨ë‹¬ì´ ìµœìƒìœ„ì— ìœ„ì¹˜ */
    		background: #fff;
    		padding: 10px;
    		box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
		}

		#mapModal button {
    		position: absolute;
    		top: 5px;
    		right: 5px;
    		z-index: 1100; /* ë‹«ê¸° ë²„íŠ¼ì„ ìµœìƒìœ„ë¡œ ì„¤ì • */
		}
        #map { width: 100%; height: 100%; }
        #closeMap { position: absolute; top: 5px; right: 5px; }
        
	</style>
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>
<header th:insert="/AppointmentPage/Header.html"></header>

<div class="container mt-5" style="max-width:100%;">
<h3 class="text-center">ë³‘ì› ì˜ˆì•½</h3>

<hr>
<div class="container d-flex justify-content-center align-items-center text-left">
<div class="row align-items-start">
<div class="col alert alert-primary" style="max-width:300px;min-width:300px;min-height:280px;max-height:280px;">
<form id="search" th:action="@{/AppointmentPage/Input}" method="get">
    <!-- ë³‘ì› ì´ë¦„ ì„ íƒ -->
    <label for="H_Categorie"><strong>* ì§„ë£Œ ê³¼ëª©</strong></label>
    <select form="search" id="H_Categorie" name="H_Categorie" class="form-control">
        <option value="" disabled>ì§„ë£Œ ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”</option>
        <option value="ë‚´ê³¼" th:selected="${H_Categorie == 'ë‚´ê³¼'}">ë‚´ê³¼</option>
    	<option value="ì†Œì•„" th:selected="${H_Categorie == 'ì†Œì•„'}">ì†Œì•„ê³¼</option>
    	<option value="ì •í˜•" th:selected="${H_Categorie == 'ì •í˜•'}">ì •í˜•ì™¸ê³¼</option>
    	<option value="ì‚°ë¶€ì¸" th:selected="${H_Categorie == 'ì‚°ë¶€ì¸ê³¼'}">ì‚°ë¶€ì¸ê³¼</option>
    	<option value="í”¼ë¶€" th:selected="${H_Categorie == 'í”¼ë¶€'}">í”¼ë¶€ê³¼</option>
    	<option value="ì´ë¹„ì¸í›„" th:selected="${H_Categorie == 'ì´ë¹„ì¸í›„'}">ì´ë¹„ì¸í›„ê³¼</option>
    	<option value="í•œì˜ì›" th:selected="${H_Categorie == 'í•œì˜ì›'}">í•œì˜ì›</option>
    	<option value="ì„±í˜•" th:selected="${H_Categorie == 'ì„±í˜•'}">ì„±í˜•ì™¸ê³¼</option>
    	<option value="ë¹„ë‡¨" th:selected="${H_Categorie == 'ë¹„ë‡¨'}">ë¹„ë‡¨ì˜í•™ê³¼</option>
    	<option value="ê°€ì •ì˜í•™ê³¼" th:selected="${H_Categorie == 'ê°€ì •ì˜í•™ê³¼'}">ê°€ì •ì˜í•™ê³¼</option>
    	<option value="ê±´ê°•ê²€ì§„" th:selected="${H_Categorie == 'ê±´ê°•ê²€ì§„'}">ê±´ê°•ê²€ì§„</option>
    	<option value="ëŒ€í•™ë³‘ì›" th:selected="${H_Categorie == 'ëŒ€í•™ë³‘ì›'}">ëŒ€í•™ë³‘ì›</option>
    	<option value="ë§ˆì·¨í†µì¦ì˜í•™ê³¼" th:selected="${H_Categorie == 'ë§ˆì·¨í†µì¦'}">ë§ˆì·¨í†µì¦ì˜í•™ê³¼</option>
    	<option value="ë³‘ë¦¬ê³¼" th:selected="${H_Categorie == 'ë³‘ë¦¬ê³¼'}">ë³‘ë¦¬ê³¼</option>
    	<option value="ìš”ì–‘ë³‘ì›" th:selected="${H_Categorie == 'ìš”ì–‘ë³‘ì›'}">ìš”ì–‘ë³‘ì›</option>
    	<option value="ìœ ë°©ì™¸ê³¼" th:selected="${H_Categorie == 'ìœ ë°©ì™¸ê³¼'}">ìœ ë°©ì™¸ê³¼</option>
    	<option value="ë³‘ë¦¬ê³¼" th:selected="${H_Categorie == 'ë³‘ë¦¬'}">ë³‘ë¦¬ê³¼</option>
    	<option value="ì¬í™œ" th:selected="${H_Categorie == 'ì¬í™œ'}">ì¬í™œì˜í•™ê³¼</option>
    	<option value="ì •ì‹ ê±´ê°•" th:selected="${H_Categorie == 'ì •ì‹ ê±´ê°•'}">ì •ì‹ ê±´ê°•ì˜í•™ê³¼</option>
    	<option value="ì¢…í•© ì˜ì›" th:selected="${H_Categorie == 'ì¢…í•© ì˜ì›'}">ì¢…í•© ì˜ì›</option>
    	<option value="í•­ë¬¸ì™¸ê³¼" th:selected="${H_Categorie == 'í•­ë¬¸ì™¸ê³¼'}">í•­ë¬¸ì™¸ê³¼</option>
    	<option value="í‰" th:selected="${H_Categorie == 'í‰ë¶€ì™¸ê³¼'}">í‰ë¶€ì™¸ê³¼</option>
    </select>
    <br>
    <label for="H_Region"><strong>* ì§€ì—­</strong></label>
    <select form="search" id="H_Region" name="H_Region" class="form-control">
        <option value="" disabled>ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”</option>
        <option value="ë‹¬ì„œêµ¬" th:selected="${H_Region == 'ë‹¬ì„œêµ¬'}">ë‹¬ì„œêµ¬</option>
        <option value="ë™êµ¬" th:selected="${H_Region == 'ë™êµ¬'}">ë™êµ¬</option>
        <option value="ì„œêµ¬" th:selected="${H_Region == 'ì„œêµ¬'}">ì„œêµ¬</option>
        <option value="ìˆ˜ì„±êµ¬" th:selected="${H_Region == 'ìˆ˜ì„±êµ¬'}">ìˆ˜ì„±êµ¬</option>
        <option value="ë‚¨êµ¬" th:selected="${H_Region == 'ë‚¨êµ¬'}">ë‚¨êµ¬</option>
        <option value="ë¶êµ¬" th:selected="${H_Region == 'ë¶êµ¬'}">ë¶êµ¬</option>
        <option value="ë‹¬ì„±êµ°" th:selected="${H_Region == 'ë‹¬ì„±êµ°'}">ë‹¬ì„±êµ°</option>
    </select>
	<br>
	<div class="container text-center">
    <button form="search" type="submit" class="btn btn-primary" style="width:100px;">ê²€ìƒ‰</button>
    <div class="text-center mt-2" th:if="${D_HospitalList == null}" th:text="|ë³‘ì›ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.|"></div>
   	<div th:if="${D_HospitalList != null}"><p></p></div>
    </div>
</form>
</div>

<!-- ê²€ìƒ‰ëœ ë³‘ì› ëª©ë¡ (checkboxë¡œ ì„ íƒ) -->
<div th:if="${D_HospitalList != null}" class="col alert alert-success" style="max-width:300px;min-width:300px;min-height:280px;max-height:280px;">
<div >
<label for="patientName"><strong>* ì˜ˆì•½ì ì´ë¦„</strong></label>
    <input form="run" type="text" class="form-control" id="patientName" name="patientName" th:value="${UserName}" required>
<br>
    <label for="appointmentTime"><strong>* ì˜ˆì•½ ì¼ì‹œ</strong></label>
    <input form="run" type="datetime-local" class="form-control" id="appointmentTime" name="appointmentTime" required>
    <br>
    <div class="text-center container">
<button form="run" type="submit" class="btn btn-success" style="width:100px;">ì˜ˆì•½</button>
<div class="mt-2" th:text="|ì˜ˆì•½ ë‚ ì§œì™€ ë³‘ì›ì„ ì„ íƒí•˜ì„¸ìš”.|"></div>
</div>
</div>
</div>
</div>
</div>
<div class="text-right mt-4">
            <button type="button" class="btn btn-secondary" onclick="history.back();">ë’¤ë¡œê°€ê¸°</button>
            <a th:href="@{/Home}" class="btn btn-secondary">í™ˆìœ¼ë¡œ</a>
        </div>


<br>
<hr>
<br>

<form id="run" th:action="@{/AppointmentPage/Reserve}" method="post">
<div class="container" style="max-width:100%;">
<h3 class="text-center">ê²€ìƒ‰ëœ ë³‘ì› ëª©ë¡</h3>
	<div class="table-responsive" style="overflow-x: auto;">
	
	<table class="table table-striped table-bordered mt-4 text-center">
		<thead class="custom-thead">
            <tr>
				<th style="min-width:10px;">ì„ íƒ</th>
				<th style="min-width:75px;">ì§€ì—­</th>
				<th>ë³‘ì›ì´ë¦„</th>
				<th>ë¶„ë¥˜</th>
				<th>ì¹´í…Œê³ ë¦¬</th>
				<th>ì´ ë³‘ìƒ</th>
				<th>ì¼ë°˜ë³‘ìƒ</th>
				<th style="min-width:110px;" >ì •ì‹ ê³¼ë³‘ìƒ</th>
				<th>ìš”ì–‘ë³‘ìƒ</th>
				<th style="min-width:130px;" >ì¤‘í™˜ìì‹¤ë³‘ìƒ</th>
				<th>ê²©ë¦¬ë³‘ìƒ</th>
				<th>ë¬´ê· ë³‘ìƒ</th>
				<th>ì „í™”</th>
				<th>ì£¼ì†Œ</th>
				<th>ì§€ë„ ë³´ê¸°</th> 
            </tr>
        </thead>
        <tbody>
            <tr th:each="hospital : ${D_HospitalList}">
                <td style="min-width:10px;" class="text-center"><input form="run" type="radio" name="selectedHospitals" th:value="${hospital.H_Id}" required/></td>
				<td th:text="${hospital.H_Region}"></td>
				<td th:text="${hospital.H_Name}"></td>
				<td th:text="${hospital.H_Department}"></td>
				<td th:text="${hospital.H_Categorie}"></td>
				<td th:text="${hospital.Bed_Total}"></td>
				<td th:text="${hospital.Bed_General}"></td>
				<td style="min-width:110px;" th:text="${hospital.Bed_Psy}"></td>
				<td th:text="${hospital.Bed_Nursing}"></td>
				<td style="min-width:130px;" th:text="${hospital.Bed_Intensive}"></td>
				<td th:text="${hospital.Bed_Isolation}"></td>
				<td th:text="${hospital.Bed_Clean}"></td>
				<td th:text="${hospital.H_Phone_Number}"></td>
                <td th:text="${hospital.H_Address}"></td>
                <td>
    				<button type="button" class="btn btn-primary" 
      				  th:attr="onclick=|showMap(${hospital.H_Latitude}, ${hospital.H_Longitude}, '${hospital.H_Name}')|">
       				  ì§€ë„ ë³´ê¸°
   					</button>
				</td>
            </tr>
        </tbody>
    </table>
    <div class="text-center" th:if="${D_HospitalList == null}" th:text="|ê²€ìƒ‰ëœ ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤.|"></div>
	</div>
	
</div>
</form>

   </div>
   
   <hr>
   <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
<div class="d-flex justify-content-center mt-4" th:if="${D_HospitalList != null}">
  <ul class="pagination">
    <!-- ì´ì „ í˜ì´ì§€ ë²„íŠ¼ -->
    <!-- ì´ì „ í˜ì´ì§€ ë²„íŠ¼ -->
<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled' : ''">
  <a class="page-link" th:href="@{/AppointmentPage/Input(page=${currentPage - 1}, H_Categorie=${H_Categorie}, H_Region=${H_Region})}" aria-label="Previous">
    <span aria-hidden="true">&laquo;</span>
  </a>
</li>

<!-- í˜ì´ì§€ ë²ˆí˜¸ ë§í¬ -->
<th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
  <li class="page-item" th:classappend="${i == currentPage} ? 'active' : ''">
    <a class="page-link" th:href="@{/AppointmentPage/Input(page=${i}, H_Categorie=${H_Categorie}, H_Region=${H_Region})}" th:text="${i + 1}"></a>
  </li>
</th:block>

<!-- ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ -->
<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled' : ''">
  <a class="page-link" th:href="@{/AppointmentPage/Input(page=${currentPage + 1}, H_Categorie=${H_Categorie}, H_Region=${H_Region})}" aria-label="Next">
    <span aria-hidden="true">&raquo;</span>
  </a>
</li>

  </ul>
</div>
<!-- ì§€ë„ ëª¨ë‹¬ -->
<div id="mapModal" style="display:none; position:fixed; top:50px; left:50%; transform:translateX(-50%); z-index:1000; background:#fff; padding:10px; box-shadow:0px 0px 10px rgba(0,0,0,0.5);">
    <div id="map" style="width:400px; height:300px;"></div>
    <button onclick="closeMap()" style="position:absolute; top:5px; right:5px;">ë‹«ê¸°</button>
</div>



<!-- âœ… ì§€ë„ ì´ˆê¸°í™” -->
<script>
	
	
	
    window.onload = function () {
        if (typeof kakao !== "undefined" && kakao.maps) {
            console.log("ì¹´ì¹´ì˜¤ API ë¡œë“œ ì™„ë£Œ!");
            initMap(); 
        } else {
            console.error("ì¹´ì¹´ì˜¤ API ë¡œë“œ ì‹¤íŒ¨!");
        }
    };

    function initMap() {
        kakao.maps.load(function() {
            var mapContainer = document.getElementById('map');
            var mapOption = { 
                center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ ì‹œì²­ ì¢Œí‘œ
                level: 3
            }; 
            var map = new kakao.maps.Map(mapContainer, mapOption);
        });
    }

function showMap(hospitalLat, hospitalLng, hospitalName) {
    if (typeof kakao === "undefined" || !kakao.maps) {
        alert("ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
        return;
    }

    kakao.maps.load(function () {
        var mapModal = document.getElementById('mapModal');
        mapModal.style.display = 'block';

        var mapContainer = document.getElementById('map');
        mapContainer.innerHTML = ""; // ì§€ë„ ì´ˆê¸°í™”

        var mapOption = {
            center: new kakao.maps.LatLng(hospitalLat, hospitalLng), // ë³‘ì› ìœ„ì¹˜ ê¸°ì¤€
            level: 3
        };

        var map = new kakao.maps.Map(mapContainer, mapOption);

        // **ë³‘ì› ë§ˆì»¤**
        var hospitalMarker = new kakao.maps.Marker({
            position: new kakao.maps.LatLng(hospitalLat, hospitalLng),
            map: map
        });

        var hospitalInfoWindow = new kakao.maps.InfoWindow({
            content: `<div style="padding:5px;">ğŸ¥ ${hospitalName}</div>`
        });
        hospitalInfoWindow.open(map, hospitalMarker);

        // **ì§€ë„ ì˜ì—­ ì¡°ì •**
        var bounds = new kakao.maps.LatLngBounds();
        bounds.extend(new kakao.maps.LatLng(hospitalLat, hospitalLng));
        map.setBounds(bounds);

        setTimeout(() => {
            map.relayout();
            map.setBounds(bounds);
        }, 300);
    });
}

   

    function closeMap() {
        document.getElementById('mapModal').style.display = 'none';
    }
</script>


   <!-- jQuery, Popper.js, Bootstrap JS ì¶”ê°€ -->
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
   <script src="/webjars/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>