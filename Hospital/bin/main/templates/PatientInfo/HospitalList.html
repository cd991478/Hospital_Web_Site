<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì¸ê·¼ ë³‘ì› ëª©ë¡</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <!--  ì¹´ì¹´ì˜¤ ì§€ë„ API ë¡œë“œ  -->
    <script type="text/javascript" 
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2e9e13d9828d100f6d488ab7d8cf5a82&libraries=services" 
    ></script>

    <style>
/* âœ… í…Œì´ë¸” ìŠ¤íƒ€ì¼ - ê³ ì •ëœ ë ˆì´ì•„ì›ƒ */
table {
    width: 100%;
    table-layout: fixed; /* âœ… ì¹¼ëŸ¼ í¬ê¸° ê³ ì • */
    border-collapse: collapse;
    border-spacing: 0;
}
body {
       font-family: 'Pretendard', sans-serif;
   }
/* âœ… í…Œì´ë¸” í—¤ë” ìŠ¤íƒ€ì¼ (ë³‘ì› ì „ì²´ ëª©ë¡ê³¼ ë™ì¼í•˜ê²Œ ì ìš©) */
thead th {
    position: sticky;
    top: 0;
    background-color: #fff3cd; /* ì—°í•œ ë…¸ë€ìƒ‰ */
    font-weight: bold;
    font-size: 14px; /* âœ… ë³‘ì› ì „ì²´ ëª©ë¡ê³¼ ë™ì¼í•œ í¬ê¸° */
    text-align: center;
    padding: 8px; /* âœ… ë™ì¼í•œ íŒ¨ë”© ê°’ */
    z-index: 1000;
    border-bottom: 1px solid #ddd;
    box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.1);
}

/* âœ… í…Œì´ë¸” ë³¸ë¬¸ ì…€ ìŠ¤íƒ€ì¼ */
td {
    text-align: center;
    padding: 8px; /* âœ… ë™ì¼í•œ íŒ¨ë”© ê°’ */
    border: 1px solid #ddd;
    font-size: 14px; /* âœ… ë™ì¼í•œ í°íŠ¸ í¬ê¸° */
    white-space: nowrap; /* âœ… ë‚´ìš© ì¤„ë°”ê¿ˆ ë°©ì§€ */
    overflow: hidden;
    text-overflow: ellipsis;
}

/* âœ… í…Œì´ë¸” ì»¨í…Œì´ë„ˆ */
.table-container {
    max-height: 700px;
    overflow-y: auto;
    border: 1px solid #ccc;
}

/* âœ… ì¹¼ëŸ¼ í¬ê¸° ë³‘ì› ì „ì²´ ëª©ë¡ê³¼ ë™ì¼í•˜ê²Œ ì¡°ì • */
th:nth-child(1), td:nth-child(1) { width: 5%; }  /* ì„ íƒ */
th:nth-child(2), td:nth-child(2) { width: 10%; } /* ì§€ì—­ */
th:nth-child(3), td:nth-child(3) { width: 15%; } /* ë³‘ì›ì´ë¦„ */
th:nth-child(4), td:nth-child(4) { width: 10%; } /* ë¶„ë¥˜ */
th:nth-child(5), td:nth-child(5) { width: 10%; } /* ì¹´í…Œê³ ë¦¬ */
th:nth-child(6), td:nth-child(6) { width: 8%; }  /* ì´ ë³‘ìƒ */
th:nth-child(7), td:nth-child(7) { width: 8%; }  /* ì¼ë°˜ë³‘ìƒ */
th:nth-child(8), td:nth-child(8) { width: 8%; }  /* ì •ì‹ ê³¼ë³‘ìƒ */
th:nth-child(9), td:nth-child(9) { width: 8%; }  /* ìš”ì–‘ë³‘ìƒ */
th:nth-child(10), td:nth-child(10) { width: 8%; } /* ì¤‘í™˜ìì‹¤ë³‘ìƒ */
th:nth-child(11), td:nth-child(11) { width: 8%; } /* ê²©ë¦¬ë³‘ìƒ */
th:nth-child(12), td:nth-child(12) { width: 8%; } /* ë¬´ê· ë³‘ìƒ */
th:nth-child(13), td:nth-child(13) { width: 10%; } /* ì „í™” */
th:nth-child(14), td:nth-child(14) { width: 15%; } /* ì£¼ì†Œ */
th:nth-child(15), td:nth-child(15) { width: 10%; } /* ì§€ë„ ë³´ê¸° */

/* âœ… ì§€ë„ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
#mapModal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* âœ… í™”ë©´ ì¤‘ì•™ ë°°ì¹˜ */
    z-index: 1000;
    background: #fff;
    padding: 10px;
    box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.3); /* âœ… ë” ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
    border-radius: 8px; /* âœ… ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
}

/* âœ… ì§€ë„ í¬ê¸° í™•ëŒ€ */
#map {
    width: 600px; /* âœ… ê¸°ì¡´ë³´ë‹¤ í™•ëŒ€ */
    height: 450px; /* âœ… ê¸°ì¡´ë³´ë‹¤ í™•ëŒ€ */
}

/* âœ… ë‹«ê¸° ë²„íŠ¼ì„ ì§€ë„ ìš°ì¸¡ ìƒë‹¨ì— ê³ ì • (ë³‘ì› ì „ì²´ ëª©ë¡ê³¼ ë™ì¼í•˜ê²Œ ë³€ê²½) */
#closeMap {
    position: absolute;
    top: 10px; 
    right: 10px; 
    background-color: #ff3333; /* âœ… ë³‘ì› ì „ì²´ ëª©ë¡ê³¼ ë™ì¼í•œ ë‹«ê¸° ë²„íŠ¼ ìƒ‰ìƒ */
    color: white;
    border: none;
    width: 50px;
    height: 30px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    border-radius: 5px; /* âœ… ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
    z-index: 1100; /* âœ… ì§€ë„ë³´ë‹¤ ìœ„ë¡œ ë°°ì¹˜ */
    transition: 0.3s;
}

/* âœ… ë‹«ê¸° ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
#closeMap:hover {
    background-color: #cc0000; /* âœ… í˜¸ë²„ ì‹œ ë” ì§„í•œ ë¹¨ê°„ìƒ‰ */
}
.card {
    background: #f8f9fa;
    border: 1px solid #ddd;
}
.btn-lg {
    font-size: 1.1rem;
}
.form-control {
    font-size: 1rem;
}

    </style>
</head>
<body>

<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<div th:replace="fragments/navbar :: navbar"></div>

<!-- í—¤ë” -->
<header th:insert="/PatientInfo/Header.html"></header>


<!-- í˜ì´ì§€ ì»¨í…ì¸  -->
<div class="container-fluid mt-5">
    <h1 class="text-center">ì¸ê·¼ ë³‘ì› ëª©ë¡</h1>

    <!-- ë²„íŠ¼ ë©”ë‰´ -->

	<form id="run" th:action="@{/AppointmentPage/Reserve}" method="post">
		<!-- ì˜ˆì•½ì ì •ë³´ ë° ë²„íŠ¼ ê·¸ë£¹ì„ í•œ ì¤„ë¡œ ì •ë ¬ -->
		<div class="card p-3 mb-4">
		    <div class="row align-items-center">
		        <!-- ì˜ˆì•½ì ì´ë¦„ ì…ë ¥ -->
		        <div class="col-md-3">
		            <label for="patientName" class="mb-1"><strong>* ì˜ˆì•½ì ì´ë¦„</strong></label>
		            <input type="text" class="form-control" id="patientName" name="patientName" required>
		        </div>

		        <!-- ì˜ˆì•½ ì¼ì‹œ ì…ë ¥ -->
		        <div class="col-md-3">
		            <label for="appointmentTime" class="mb-1"><strong>* ì˜ˆì•½ ì¼ì‹œ</strong></label>
		            <input type="datetime-local" class="form-control" id="appointmentTime" name="appointmentTime" required>
		        </div>

		        <!-- ë²„íŠ¼ ê·¸ë£¹ -->
		        <div class="col-md-6 text-right">
		            <button type="submit" class="btn btn-success btn-lg px-4 mr-2">ì˜ˆì•½í•˜ê¸°</button>
		            <button type="button" class="btn btn-secondary btn-lg mx-2" onclick="history.back()">â¬…ï¸ ë’¤ë¡œê°€ê¸°</button>
		            <a class="btn btn-secondary btn-lg" th:href="@{/}">í™ˆìœ¼ë¡œ</a>
		        </div>
		    </div>
		</div>
    <!-- í…Œì´ë¸” ì»¨í…Œì´ë„ˆ -->
    <div class="table-container">
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ì„ íƒ</th>
                <th>ì§€ì—­</th>
                <th>ë³‘ì›ì´ë¦„</th>
                <th>ë¶„ë¥˜</th>
                <th>ì¹´í…Œê³ ë¦¬</th>
                <th>ì´ ë³‘ìƒ</th>
                <th>ì¼ë°˜ë³‘ìƒ</th>
                <th>ì •ì‹ ê³¼ë³‘ìƒ</th>
                <th>ìš”ì–‘ë³‘ìƒ</th>
                <th>ì¤‘í™˜ìì‹¤ë³‘ìƒ</th>
                <th>ê²©ë¦¬ë³‘ìƒ</th>
                <th>ë¬´ê· ë³‘ìƒ</th>
                <th>ì „í™”</th>
                <th>ì£¼ì†Œ</th>
                <th>ì§€ë„ ë³´ê¸°</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="Hospital : ${D_HospitalList}">
                <td><input type="radio" name="selectedHospitals" th:value="${Hospital.H_Id}"></td>
                <td th:text="${Hospital.H_Region}"></td>
                <td th:text="${Hospital.H_Name}"></td>
                <td th:text="${Hospital.H_Department}"></td>
                <td th:text="${Hospital.H_Categorie}"></td>
                <td th:text="${Hospital.Bed_Total}"></td>
                <td th:text="${Hospital.Bed_General}"></td>
                <td th:text="${Hospital.Bed_Psy}"></td>
                <td th:text="${Hospital.Bed_Nursing}"></td>
                <td th:text="${Hospital.Bed_Intensive}"></td>
                <td th:text="${Hospital.Bed_Isolation}"></td>
                <td th:text="${Hospital.Bed_Clean}"></td>
                <td th:text="${Hospital.H_Phone_Number}"></td>
                <td th:text="${Hospital.H_Address}"></td>
				<td>
				    <button type="button" class="btn btn-primary" 
				        th:if="${Hospital.H_Latitude != null and Hospital.H_Longitude != null}"
				        th:attr="onclick=|showMap(${Hospital.H_Latitude}, ${Hospital.H_Longitude}, '${Hospital.H_Name}', ${session.GeoAddressLatitude}, ${session.GeoAddressLongitude})|">
				        ì§€ë„ ë³´ê¸°
				    </button>
				</td>
            </tr>
        </tbody>
    </table>
</div>
</form>
</div>



<!-- ì§€ë„ ëª¨ë‹¬ -->
<div id="mapModal">
    <button id="closeMap" onclick="closeMap()">ë‹«ê¸°</button> <!-- âœ… ë³‘ì› ì „ì²´ ëª©ë¡ê³¼ ë™ì¼í•œ ë‹«ê¸° ë²„íŠ¼ ì ìš© -->
    <div id="map"></div>
</div>


<!-- âœ… ì§€ë„ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    function showMap(hospitalLat, hospitalLng, hospitalName, patientLat, patientLng) {
        if (typeof kakao === "undefined" || !kakao.maps) {
            alert("ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
            return;
        }

        kakao.maps.load(function () {
            var mapModal = document.getElementById('mapModal');
            mapModal.style.display = 'block';

            var mapContainer = document.getElementById('map');
            mapContainer.innerHTML = ""; // ì§€ë„ ì´ˆê¸°í™”

            var mapOption = {
                center: new kakao.maps.LatLng(hospitalLat, hospitalLng),
                level: 3
            };

            var map = new kakao.maps.Map(mapContainer, mapOption);

            var hospitalMarker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(hospitalLat, hospitalLng),
                map: map
            });

            var hospitalInfoWindow = new kakao.maps.InfoWindow({
                content: `<div style="padding:5px;">ğŸ¥ ${hospitalName}</div>`
            });
            hospitalInfoWindow.open(map, hospitalMarker);

            if (patientLat && patientLng) {
                var patientMarker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(patientLat, patientLng),
                    map: map
                });

                var patientInfoWindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:5px;">ğŸ  ë‚˜ì˜ ìœ„ì¹˜</div>`
                });
                patientInfoWindow.open(map, patientMarker);
            }

            var bounds = new kakao.maps.LatLngBounds();
            bounds.extend(new kakao.maps.LatLng(hospitalLat, hospitalLng));
            if (patientLat && patientLng) {
                bounds.extend(new kakao.maps.LatLng(patientLat, patientLng));
            }
            map.setBounds(bounds);

            setTimeout(() => {
                map.relayout();
                map.setBounds(bounds);
            }, 300);
        });
    }
    
    function closeMap() {
        document.getElementById('mapModal').style.display = 'none';
    }
    
    // í´ë¼ì´ì–¸íŠ¸ ì„¸ì…˜ ê°’ ì‚­ì œ í•¨ìˆ˜
function clearGeoSessionLocal() {
    sessionStorage.removeItem("GeoAddressLatitude");
    sessionStorage.removeItem("GeoAddressLongitude");
}

// ëª©ë¡ ë²„íŠ¼ í´ë¦­ ì‹œ í´ë¼ì´ì–¸íŠ¸ ì„¸ì…˜ ì‚­ì œ
document.getElementById("listButton").addEventListener("click", function () {
    clearGeoSessionLocal();
});

// í™ˆìœ¼ë¡œ ë²„íŠ¼ í´ë¦­ ì‹œ í´ë¼ì´ì–¸íŠ¸ ì„¸ì…˜ ì‚­ì œ
document.getElementById("homeButton").addEventListener("click", function () {
    clearGeoSessionLocal();
});

// ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ í´ë¼ì´ì–¸íŠ¸ ì„¸ì…˜ ì‚­ì œ í›„ ì‚­ì œ ìš”ì²­
document.getElementById("deleteButton").addEventListener("click", function () {
    clearGeoSessionLocal();
    document.getElementById("deleteForm").submit(); 
});
    
</script>

<!-- âœ… Bootstrap ë° jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>
