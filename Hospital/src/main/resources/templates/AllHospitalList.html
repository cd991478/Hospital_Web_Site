<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë³‘ì› ì „ì²´ ëª©ë¡</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
       <!--  ì¹´ì¹´ì˜¤ ì§€ë„ API ë¡œë“œ  -->
    <script type="text/javascript" 
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2e9e13d9828d100f6d488ab7d8cf5a82&libraries=services" >
    </script>
	<style>
		body {
			    font-family: 'Pretendard', sans-serif;
			}
	   	th,td{
	   		min-width: 90px;
	   	}
	   	.custom-thead{
	   		background-color:#fff3cd;
	   	}
	   	
#mapModal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1050; /* ëª¨ë‹¬ì´ ë‹¤ë¥¸ ìš”ì†Œë³´ë‹¤ ìœ„ë¡œ */
    background: #fff;
    padding: 15px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
    border-radius: 10px;
    width: 600px; /* ì§€ë„ í¬ê¸° í™•ëŒ€ */
    height: 500px;
    overflow: hidden;
}
#mapModal .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: red;
    color: white;
    border: none;
    padding: 7px 12px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 16px;
    z-index: 1100; /* ì§€ë„ë³´ë‹¤ ìœ„ë¡œ ë°°ì¹˜ */
}

#map {
    width: 100%;
    height: 100%;
}
        #closeMap { position: absolute; top: 5px; right: 5px; }
        
	</style>
    <script>
    function CheckLogin() {
      alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    }
  </script>
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>
    <header th:insert="/BoardPage/Header.html"></header>
	<div class="container-fluid mt-5">
	  <h1 class="text-center">ë³‘ì› ì „ì²´ ëª©ë¡</h1>
	  <hr>
<div class="container d-flex justify-content-center align-items-center">
    <form id="search" th:action="@{/AllHospitalList}" method="get" class="w-100">
        <div class="row justify-content-center align-items-end">
            <!-- ì§„ë£Œ ê³¼ëª© ì„ íƒ -->
            <div class="col-md-5">
                <label for="H_Categorie"><strong>* ì§„ë£Œ ê³¼ëª©</strong></label>
                <select id="H_Categorie" name="H_Categorie" class="form-control">
                    <option value="" disabled>ì§„ë£Œ ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ë‚´ê³¼" th:selected="${H_Categorie == 'ë‚´ê³¼'}">ë‚´ê³¼</option>
                    <option value="ì†Œì•„" th:selected="${H_Categorie == 'ì†Œì•„'}">ì†Œì•„ê³¼</option>
                    <option value="ì •í˜•" th:selected="${H_Categorie == 'ì •í˜•'}">ì •í˜•ì™¸ê³¼</option>
                    <option value="ì‚°ë¶€ì¸" th:selected="${H_Categorie == 'ì‚°ë¶€ì¸ê³¼'}">ì‚°ë¶€ì¸ê³¼</option>
                    <option value="í”¼ë¶€" th:selected="${H_Categorie == 'í”¼ë¶€'}">í”¼ë¶€ê³¼</option>
                    <option value="ì´ë¹„ì¸í›„" th:selected="${H_Categorie == 'ì´ë¹„ì¸í›„'}">ì´ë¹„ì¸í›„ê³¼</option>
                    <option value="í•œì˜ì›" th:selected="${H_Categorie == 'í•œì˜ì›'}">í•œì˜ì›</option>
                    <option value="ì„±í˜•" th:selected="${H_Categorie == 'ì„±í˜•'}">ì„±í˜•ì™¸ê³¼</option>
                    <option value="ë¹„ë‡¨" th:selected="${H_Categorie == 'ë¹„ë‡¨'}">ë¹„ë‡¨ì˜í•™ê³¼</option>
                    <option value="ê°€ì •ì˜í•™ê³¼" th:selected="${H_Categorie == 'ê°€ì •ì˜í•™ê³¼'}">ê°€ì •ì˜í•™ê³¼</option>
                    <option value="ê±´ê°•ê²€ì§„" th:selected="${H_Categorie == 'ê±´ê°•ê²€ì§„'}">ê±´ê°•ê²€ì§„</option>
                </select>
            </div>

            <!-- ì§€ì—­ ì„ íƒ -->
            <div class="col-md-5">
                <label for="H_Region"><strong>* ì§€ì—­</strong></label>
                <select id="H_Region" name="H_Region" class="form-control">
                    <option value="" disabled>ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ë‹¬ì„œêµ¬" th:selected="${H_Region == 'ë‹¬ì„œêµ¬'}">ë‹¬ì„œêµ¬</option>
                    <option value="ë™êµ¬" th:selected="${H_Region == 'ë™êµ¬'}">ë™êµ¬</option>
                    <option value="ì„œêµ¬" th:selected="${H_Region == 'ì„œêµ¬'}">ì„œêµ¬</option>
                    <option value="ìˆ˜ì„±êµ¬" th:selected="${H_Region == 'ìˆ˜ì„±êµ¬'}">ìˆ˜ì„±êµ¬</option>
                    <option value="ë‚¨êµ¬" th:selected="${H_Region == 'ë‚¨êµ¬'}">ë‚¨êµ¬</option>
                    <option value="ë¶êµ¬" th:selected="${H_Region == 'ë¶êµ¬'}">ë¶êµ¬</option>
                    <option value="ë‹¬ì„±êµ°" th:selected="${H_Region == 'ë‹¬ì„±êµ°'}">ë‹¬ì„±êµ°</option>
                </select>
            </div>

            <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
            <div class="col-md-2 text-center">
                <button type="submit" class="btn btn-primary mt-4">ê²€ìƒ‰</button>
            </div>
        </div>
    </form>
</div>


  
        <div class="text-right">
      		<a class="btn btn-secondary mr-2" onclick="history.back()">ë’¤ë¡œê°€ê¸°</a>
      		<a class="btn btn-secondary" th:href="@{/Home}">í™ˆìœ¼ë¡œ</a>
    	</div>
    	
        <div class="table-responsive" style="overflow-x: auto;">
        <table class="table table-striped table-bordered mt-4 text-center">
            <thead class="custom-thead">
                <tr>
                    <th style="min-width:75px;">ì§€ì—­</th>
                    <th>ë³‘ì›ì´ë¦„</th>
                    <th>ë¶„ë¥˜</th>
                    <th>ì¹´í…Œê³ ë¦¬</th>
                    <th>ì´ ë³‘ìƒ</th>
                    <th>ì¼ë°˜ë³‘ìƒ</th>
                    <th style="min-width:110px;" >ì •ì‹ ê³¼ë³‘ìƒ</th>
                    <th>ìš”ì–‘ë³‘ìƒ</th>
                    <th style="min-width:130px;" >ì¤‘í™˜ìì‹¤ë³‘ìƒ</th>
                    <th>ê²©ë¦¬ë³‘ìƒ</th>
                    <th>ë¬´ê· ë³‘ìƒ</th>
                    <th style="min-width:200px;">ì „í™”</th>
                    <th>ì£¼ì†Œ</th>
                    <th>ì§€ë„</th>
                </tr>
            </thead>
         <tbody>
            <tr th:each="hospital : ${D_HospitalList}">
				<td th:text="${hospital.H_Region}"></td>
				<td th:text="${hospital.H_Name}"></td>
				<td th:text="${hospital.H_Department}"></td>
				<td th:text="${hospital.H_Categorie}"></td>
				<td th:text="${hospital.Bed_Total}"></td>
				<td th:text="${hospital.Bed_General}"></td>
				<td style="min-width:110px;" th:text="${hospital.Bed_Psy}"></td>
				<td th:text="${hospital.Bed_Nursing}"></td>
				<td style="min-width:130px;" th:text="${hospital.Bed_Intensive}"></td>
				<td th:text="${hospital.Bed_Isolation}"></td>
				<td th:text="${hospital.Bed_Clean}"></td>
				<td th:text="${hospital.H_Phone_Number}"></td>
                <td th:text="${hospital.H_Address}"></td>
                <td>
    			<button type="button" class="btn btn-primary" 
      				  th:attr="onclick=|showMap(${hospital.H_Latitude}, ${hospital.H_Longitude}, '${hospital.H_Name}')|">
       				  ì§€ë„ ë³´ê¸°
   				</button>
				</td>
            </tr>
        </tbody>
        </table>
        </div>
    </div>
  <hr>
   <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
<div class="d-flex justify-content-center mt-4" th:if="${D_HospitalList != null}">
  <ul class="pagination">
<!-- ì´ì „ í˜ì´ì§€ ë²„íŠ¼ -->
<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled' : ''">
  <a class="page-link" th:href="@{/AllHospitalList(page=${currentPage - 1}, H_Categorie=${H_Categorie}, H_Region=${H_Region})}" aria-label="Previous">
    <span aria-hidden="true">&laquo;</span>
  </a>
</li>

<!-- í˜ì´ì§€ ë²ˆí˜¸ ë§í¬ -->
<th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
  <li class="page-item" th:classappend="${i == currentPage} ? 'active' : ''">
    <a class="page-link" th:href="@{/AllHospitalList(page=${i}, H_Categorie=${H_Categorie}, H_Region=${H_Region})}" th:text="${i + 1}"></a>
  </li>
</th:block>

<!-- ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ -->
<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled' : ''">
  <a class="page-link" th:href="@{/AllHospitalList(page=${currentPage + 1}, H_Categorie=${H_Categorie}, H_Region=${H_Region})}" aria-label="Next">
    <span aria-hidden="true">&raquo;</span>
  </a>
</li>


  </ul>
</div>
<!-- ì§€ë„ ëª¨ë‹¬ -->
<div id="mapModal">
    <button class="close-btn" onclick="closeMap()">ë‹«ê¸°</button>
    <div id="map" style="width: 100%; height: 100%;"></div>
</div>



<!-- âœ… ì§€ë„ ì´ˆê¸°í™” -->
<script>
    window.onload = function () {
        if (typeof kakao !== "undefined" && kakao.maps) {
            console.log("ì¹´ì¹´ì˜¤ API ë¡œë“œ ì™„ë£Œ!");
            initMap(); 
        } else {
            console.error("ì¹´ì¹´ì˜¤ API ë¡œë“œ ì‹¤íŒ¨!");
        }
    };

    function initMap() {
        kakao.maps.load(function() {
            var mapContainer = document.getElementById('map');
            var mapOption = { 
                center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ ì‹œì²­ ì¢Œí‘œ
                level: 3
            }; 
            var map = new kakao.maps.Map(mapContainer, mapOption);
        });
    }

function showMap(hospitalLat, hospitalLng, hospitalName) {
    if (typeof kakao === "undefined" || !kakao.maps) {
        alert("ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
        return;
    }

    kakao.maps.load(function () {
        var mapModal = document.getElementById('mapModal');
        mapModal.style.display = 'block';

        var mapContainer = document.getElementById('map');
        mapContainer.innerHTML = ""; // ì§€ë„ ì´ˆê¸°í™”

        var mapOption = {
            center: new kakao.maps.LatLng(hospitalLat, hospitalLng), // ë³‘ì› ìœ„ì¹˜ ê¸°ì¤€
            level: 3
        };

        var map = new kakao.maps.Map(mapContainer, mapOption);

        // **ë³‘ì› ë§ˆì»¤**
        var hospitalMarker = new kakao.maps.Marker({
            position: new kakao.maps.LatLng(hospitalLat, hospitalLng),
            map: map
        });

        var hospitalInfoWindow = new kakao.maps.InfoWindow({
            content: `<div style="
        	padding: 5px;
       		white-space: nowrap; 
        	overflow: hidden;
        	text-overflow: ellipsis;
        	max-width: 200px;
    ">ğŸ¥ ${hospitalName}</div>`
        });
        hospitalInfoWindow.open(map, hospitalMarker);

        // **ì§€ë„ ì˜ì—­ ì¡°ì •**
        var bounds = new kakao.maps.LatLngBounds();
        bounds.extend(new kakao.maps.LatLng(hospitalLat, hospitalLng));
        map.setBounds(bounds);

        setTimeout(() => {
            map.relayout();
            map.setBounds(bounds);
        }, 300);
    });
}

   

    function closeMap() {
        document.getElementById('mapModal').style.display = 'none';
    }
</script>
    <!-- Bootstrap JS (optional for interactive components) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
